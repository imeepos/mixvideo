# 视频分析Tab功能说明

## 🎯 **功能概述**

在shot_detection项目的GUI界面中新增了 **🎥 视频分析** Tab，集成了Google Gemini AI进行智能视频内容分析，使用专门的video-analysis提示词进行深度分析。

## 📋 **主要特性**

### 🤖 **AI驱动的视频分析**
- 使用Google Gemini 2.0 Flash Exp模型
- 专业的女装视频资源管理提示词
- 支持多种视频格式（MP4, AVI, MOV, MKV等）
- 智能内容识别和场景分析

### 🎨 **用户友好的界面**
- 简洁的Tab式布局
- 直观的文件选择和配置
- 实时进度显示
- 详细的分析结果展示

### 📊 **丰富的分析结果**
- 场景检测和时间轴分析
- 物体识别和内容总结
- 情感基调和关键词提取
- 技术参数分析（拍摄风格、构图等）

## 🖥️ **界面结构**

```
🎥 视频分析 Tab
├── 📁 视频文件选择
│   ├── 视频文件路径输入
│   ├── 输出目录选择
│   └── 文件浏览按钮
├── 🤖 Gemini AI 配置
│   ├── API Key输入（加密显示）
│   ├── 模型选择下拉框
│   └── 配置说明信息
├── 🚀 分析控制按钮
│   ├── 开始分析
│   ├── 停止分析
│   └── 打开结果目录
└── 📊 分析结果显示
    ├── 结果统计标签
    └── 详细结果文本框
```

## 🔧 **核心组件**

### **1. GeminiVideoAnalyzer类**
- **文件位置**: `gemini_video_analyzer.py`
- **功能**: 封装Gemini API调用逻辑
- **特性**: 
  - 视频文件上传和处理
  - API请求管理
  - 结果解析和格式化
  - 错误处理和重试机制

### **2. 提示词集成**
- **提示词来源**: `prompts/video-analysis.prompt`
- **管理方式**: 通过`prompts_manager.py`动态加载
- **特点**: 专门针对女装电商视频优化的分析提示词

### **3. GUI集成**
- **新增变量**: 
  ```python
  self.analysis_video_path = tk.StringVar()      # 分析视频路径
  self.analysis_output_dir = tk.StringVar()      # 输出目录
  self.gemini_api_key = tk.StringVar()           # API密钥
  self.analysis_model = tk.StringVar()           # 模型选择
  ```

## 🚀 **使用流程**

### **步骤1: 选择视频文件**
1. 点击"浏览"按钮选择要分析的视频文件
2. 系统自动设置输出目录（可手动修改）
3. 支持的格式：MP4, AVI, MOV, MKV, WMV, FLV, WebM, M4V

### **步骤2: 配置Gemini AI**
1. 输入有效的Google AI Studio API Key
2. 选择分析模型（推荐：gemini-2.0-flash-exp）
3. 查看配置说明确保设置正确

### **步骤3: 开始分析**
1. 点击"🚀 开始分析"按钮
2. 观察实时进度显示：
   - 初始化Gemini客户端
   - 加载分析提示词
   - 上传视频到Gemini
   - 等待AI分析
   - 生成分析报告
3. 分析完成后查看详细结果

### **步骤4: 查看结果**
1. 在结果区域查看分析摘要
2. 浏览详细的分析报告
3. 点击"📁 打开结果目录"查看保存的JSON文件

## 📊 **分析结果格式**

### **JSON输出结构**
```json
{
  "video_info": {
    "file_name": "视频文件名",
    "file_path": "完整文件路径", 
    "analysis_time": "分析时间",
    "model_used": "使用的AI模型"
  },
  "analysis_result": {
    "content_analysis": {
      "summary": "内容摘要",
      "scenes": ["场景列表"],
      "objects": ["识别对象"],
      "keywords": ["关键词"],
      "emotion": "情感基调"
    }
  },
  "raw_response": "原始API响应"
}
```

### **界面显示内容**
- 📹 **视频信息**: 文件名、分析时间、使用模型
- 📝 **内容摘要**: AI生成的视频内容概述
- 🎬 **场景分析**: 时间轴和场景描述
- 🏷️ **关键词**: 提取的相关标签
- 📷 **技术分析**: 拍摄风格、构图、光线等

## ⚙️ **技术实现**

### **API集成**
- **端点**: Google Generative Language API
- **认证**: API Key方式
- **文件上传**: 支持最大20MB视频文件
- **超时处理**: 智能重试和错误恢复

### **提示词系统**
- **动态加载**: 从本地文件实时读取提示词
- **专业优化**: 针对女装电商视频的专业分析
- **灵活配置**: 支持提示词的修改和更新

### **错误处理**
- **API失败**: 自动回退到模拟分析模式
- **网络超时**: 智能重试机制
- **文件错误**: 详细的错误提示和建议

## 🔒 **安全考虑**

### **API Key保护**
- 界面中使用密码框隐藏API Key
- 不在日志中记录敏感信息
- 建议使用环境变量存储密钥

### **文件处理**
- 本地文件验证和大小检查
- 安全的临时文件处理
- 自动清理上传的远程文件

## 🧪 **测试和调试**

### **模拟模式**
- 当API调用失败时自动启用
- 生成示例分析结果用于测试
- 保持界面功能的完整性

### **日志记录**
- 详细的操作日志
- 错误信息和调试信息
- 进度跟踪和状态更新

## 📈 **性能优化**

### **异步处理**
- 使用独立线程进行API调用
- 非阻塞的用户界面
- 实时进度反馈

### **缓存机制**
- 提示词缓存减少文件读取
- 结果本地保存避免重复分析
- 智能的资源管理

## 🔮 **未来扩展**

### **计划功能**
- 支持批量视频分析
- 自定义分析模板
- 结果导出多种格式
- 分析历史记录管理

### **集成可能**
- 与视频分段功能联动
- 智能文件夹分类建议
- 自动化工作流程

## 💡 **使用建议**

1. **API Key获取**: 访问 [Google AI Studio](https://makersuite.google.com/) 获取免费API Key
2. **视频准备**: 建议使用清晰、时长适中的视频文件
3. **网络环境**: 确保稳定的网络连接以获得最佳体验
4. **结果保存**: 及时保存重要的分析结果到本地

这个新的视频分析Tab为shot_detection项目增加了强大的AI分析能力，特别适合女装电商视频的专业分析需求！🎉
